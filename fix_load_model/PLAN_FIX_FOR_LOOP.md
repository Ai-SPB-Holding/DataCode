# План исправления ошибки "Variable 'for' not found"

## Проблема
Ошибка возникает при выполнении `load_model_data.dc` на строке 46 (или 89 в зависимости от контекста):
```
Variable Error at line 46: Variable 'for' not found
```

После добавления проверок ошибка изменилась на:
```
Syntax Error at line 46, column 0: Unexpected keyword 'for month_dir_name in month_dirs do' in expression context
```

## Анализ проблемы

1. **Корневая причина**: Циклы `for` внутри блоков `try` не распознаются правильно функцией `execute_block_with_try_support`.

2. **Текущее состояние**:
   - В `execute_block_with_try_support` есть проверка на `for` циклы (строка 1719)
   - Но `for` циклы все равно попадают в `eval_expr` через `execute_line_simple_safe`
   - Это означает, что проверка не срабатывает или обходится

3. **Проблемные места**:
   - `execute_block_with_try_support` - не распознает `for` циклы правильно
   - `execute_line_simple_safe` - пытается выполнить `for` как выражение
   - `eval_expr` - парсит `for` как переменную

## Решение

### Шаг 1: Улучшить проверку в `execute_block_with_try_support`
- Убедиться, что проверка на `for` циклы работает корректно
- Добавить отладочный вывод для диагностики

### Шаг 2: Улучшить `execute_line_simple_safe`
- Добавить проверку на `for` циклы перед вызовом `eval_expr`
- Выдать понятную ошибку, если `for` попал в неправильный контекст

### Шаг 3: Проверить парсинг тела функции
- Убедиться, что тело функции сохраняется правильно
- Проверить, что строки не теряют форматирование

### Шаг 4: Тестирование
- Запустить все тесты в `fix_load_model`
- Проверить, что `load_model_data.dc` выполняется успешно

## Текущий статус

✅ Добавлена проверка на `for` в `eval_expr`
✅ Добавлена проверка на `for` в `execute_line_simple`
✅ Добавлена проверка на `if` в `execute_block_with_try_support`
❌ Проблема все еще возникает - `for` циклы внутри `try` блоков не распознаются

## Следующие шаги

1. Добавить более детальную проверку в `execute_block_with_try_support`
2. Проверить, как сохраняются строки тела `try` блока
3. Убедиться, что `for` циклы правильно обрабатываются во всех контекстах

