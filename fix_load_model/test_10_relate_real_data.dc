# –¢–µ—Å—Ç —Ñ—É–Ω–∫—Ü–∏–∏ relate() —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ load_model_data

print("============================================================")
print("–¢–µ—Å—Ç relate() —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ model_data")
print("============================================================")
print()

# –ë–∞–∑–æ–≤—ã–π –ø—É—Ç—å –∫ –¥–∞–Ω–Ω—ã–º
global base_path = getcwd() / "model_data"
global docs_path = base_path / "docs"

print("üìÇ –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤...")
# –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏
global product_catalog = read_file(docs_path / "product_catalog.csv")
global regions_table = read_file(docs_path / "regions.csv")
global employees_table = read_file(docs_path / "employees.csv")

print("  ‚úì –ó–∞–≥—Ä—É–∂–µ–Ω–æ –ø—Ä–æ–¥—É–∫—Ç–æ–≤: ", len(product_catalog))
print("  ‚úì –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ä–µ–≥–∏–æ–Ω–æ–≤: ", len(regions_table))
print("  ‚úì –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤: ", len(employees_table))
print()

# –ó–∞–≥—Ä—É–∂–∞–µ–º –æ–¥–∏–Ω –º–µ—Å—è—Ü –ø—Ä–æ–¥–∞–∂ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
print("üìä –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–¥–∞–∂...")
global sales_path = base_path / "2025" / "01" / "sales_2025_01.csv"
global sales_data = read_file(sales_path)
print("  ‚úì –ó–∞–≥—Ä—É–∂–µ–Ω–æ –ø—Ä–æ–¥–∞–∂: ", len(sales_data), " —Å—Ç—Ä–æ–∫")
print()

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü
print("üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü:")
print("  product_catalog: ", table_headers(product_catalog))
print("  regions: ", table_headers(regions_table))
print("  employees: ", table_headers(employees_table))
print("  sales_data: ", table_headers(sales_data))
print()

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Å–≤—è–∑–µ–π –∫–∞–∫ null
global relation_product_sales = null
global relation_region_sales = null
global relation_employee_sales = null

# –¢–µ—Å—Ç 1: –°–≤—è–∑—å product_catalog ‚Üî sales_data –ø–æ product_id
print("üîó –¢–µ—Å—Ç 1: –°–≤—è–∑—å product_catalog ‚Üî sales_data –ø–æ product_id")
try
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–æ–ª–æ–Ω–æ–∫
    local product_headers = table_headers(product_catalog)
    local sales_headers = table_headers(sales_data)
    
    if contains(product_headers, "product_id") and contains(sales_headers, "product_id") do
        global relation_product_sales = relate(product_catalog["product_id"], sales_data["product_id"])
        print("  ‚úì –°–≤—è–∑—å —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ")
        print("    product_catalog.product_id ‚Üî sales_data.product_id")
        print("    –¢–∏–ø: String ‚Üí String")
    else
        print("  ‚ö†Ô∏è  –ö–æ–ª–æ–Ω–∫–∞ product_id –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ –æ–¥–Ω–æ–π –∏–∑ —Ç–∞–±–ª–∏—Ü")
        print("    product_catalog –∫–æ–ª–æ–Ω–∫–∏: ", product_headers)
        print("    sales_data –∫–æ–ª–æ–Ω–∫–∏: ", sales_headers)
    endif
catch e
    print("  ‚úó –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–≤—è–∑–∏: ", e)
endtry
print()

# –¢–µ—Å—Ç 2: –°–≤—è–∑—å regions ‚Üî sales_data –ø–æ region
print("üîó –¢–µ—Å—Ç 2: –°–≤—è–∑—å regions ‚Üî sales_data –ø–æ region")
try
    local region_headers = table_headers(regions_table)
    local sales_headers2 = table_headers(sales_data)
    
    # –ò—â–µ–º –∫–æ–ª–æ–Ω–∫—É region –≤ –æ–±–µ–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö
    # –í regions –º–æ–∂–µ—Ç –±—ã—Ç—å region_code, region_id –∏–ª–∏ region
    # –í sales_data –µ—Å—Ç—å region
    local region_col = null
    if contains(region_headers, "region_code") do
        region_col = "region_code"
    else if contains(region_headers, "region_id") do
        region_col = "region_id"
    else if contains(region_headers, "region") do
        region_col = "region"
    endif
    
    if region_col != null and contains(sales_headers2, "region") do
        global relation_region_sales = relate(regions_table[region_col], sales_data["region"])
        print("  ‚úì –°–≤—è–∑—å —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ")
        print("    regions.", region_col, " ‚Üî sales_data.region")
        print("    –¢–∏–ø: String ‚Üí String")
    else
        if region_col == null do
            print("  ‚ö†Ô∏è  –ö–æ–ª–æ–Ω–∫–∞ region –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ regions")
            print("    –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏: ", region_headers)
        endif
        if not contains(sales_headers2, "region") do
            print("  ‚ö†Ô∏è  –ö–æ–ª–æ–Ω–∫–∞ region –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ sales_data")
        endif
    endif
catch e
    print("  ‚úó –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–≤—è–∑–∏: ", e)
endtry
print()

# –¢–µ—Å—Ç 3: –°–≤—è–∑—å employees ‚Üî sales_data –ø–æ employee_id
print("üîó –¢–µ—Å—Ç 3: –°–≤—è–∑—å employees ‚Üî sales_data –ø–æ employee_id")
try
    local employee_headers = table_headers(employees_table)
    local sales_headers3 = table_headers(sales_data)
    
    if contains(employee_headers, "employee_id") and contains(sales_headers3, "employee_id") do
        global relation_employee_sales = relate(employees_table["employee_id"], sales_data["employee_id"])
        print("  ‚úì –°–≤—è–∑—å —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ")
        print("    employees.employee_id ‚Üî sales_data.employee_id")
        print("    –¢–∏–ø: String ‚Üí String")
    else
        print("  ‚ö†Ô∏è  –ö–æ–ª–æ–Ω–∫–∞ employee_id –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ –æ–¥–Ω–æ–π –∏–∑ —Ç–∞–±–ª–∏—Ü")
    endif
catch e
    print("  ‚úó –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–≤—è–∑–∏: ", e)
endtry
print()

# –¢–µ—Å—Ç 4: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è —Å–≤—è–∑—å (3+ –ø–æ–ª—è)
print("üîó –¢–µ—Å—Ç 4: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è —Å–≤—è–∑—å –º–µ–∂–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏")
try
    # –°–æ–∑–¥–∞–µ–º —Ü–µ–ø–æ—á–∫—É —Å–≤—è–∑–µ–π: product_catalog ‚Üí sales ‚Üí employees
    local relations_found = 0
    if relation_product_sales != null do
        print("  ‚úì –°–≤—è–∑—å 1: product_catalog ‚Üî sales_data")
        relations_found = relations_found + 1
    endif
    if relation_employee_sales != null do
        print("  ‚úì –°–≤—è–∑—å 2: employees ‚Üî sales_data")
        relations_found = relations_found + 1
    endif
    if relation_region_sales != null do
        print("  ‚úì –°–≤—è–∑—å 3: regions ‚Üî sales_data")
        relations_found = relations_found + 1
    endif
    
    if relations_found > 0 do
        print("  ‚úì –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–≤—è–∑–∏ —Å–æ–∑–¥–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ")
        print("    –í—Å–µ —Å–≤—è–∑–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ —Ç–∞–±–ª–∏—Ü—É sales_data")
        print("    –í—Å–µ–≥–æ —Å–æ–∑–¥–∞–Ω–æ —Å–≤—è–∑–µ–π: ", relations_found)
    else
        print("  ‚ö†Ô∏è  –ù–µ —Å–æ–∑–¥–∞–Ω–æ –Ω–∏ –æ–¥–Ω–æ–π —Å–≤—è–∑–∏")
    endif
catch e
    print("  ‚úó –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–≤—è–∑–µ–π: ", e)
endtry
print()

# –¢–µ—Å—Ç 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã—Ö —Ç–∏–ø–æ–≤
print("üîó –¢–µ—Å—Ç 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã—Ö —Ç–∏–ø–æ–≤ (–æ–∂–∏–¥–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞)")
try
    # –ü—ã—Ç–∞–µ–º—Å—è —Å–≤—è–∑–∞—Ç—å String —Å Number
    local sales_headers4 = table_headers(sales_data)
    if contains(sales_headers4, "product_id") and contains(sales_headers4, "units") do
        global relation_wrong = relate(sales_data["product_id"], sales_data["units"])
        print("  ‚úó –û—à–∏–±–∫–∞: —Å–≤—è–∑—å –º–µ–∂–¥—É –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–º–∏ —Ç–∏–ø–∞–º–∏ –Ω–µ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω–∞")
    else
        print("  ‚ö†Ô∏è  –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–æ–ª–æ–Ω–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –¥–ª—è —Ç–µ—Å—Ç–∞")
    endif
catch e
    print("  ‚úì –û—à–∏–±–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞: ", e)
    print("    –¢–∏–ø—ã –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã: String (product_id) ‚â† Number (units)")
endtry
print()

# –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
print("============================================================")
print("üìä –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞")
print("============================================================")
print()

global relations_count = 0
if relation_product_sales != null do
    relations_count = relations_count + 1
endif
if relation_region_sales != null do
    relations_count = relations_count + 1
endif
if relation_employee_sales != null do
    relations_count = relations_count + 1
endif

print("  –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ç–∞–±–ª–∏—Ü: 4")
print("    - product_catalog: ", len(product_catalog), " —Å—Ç—Ä–æ–∫")
print("    - regions: ", len(regions_table), " —Å—Ç—Ä–æ–∫")
print("    - employees: ", len(employees_table), " —Å—Ç—Ä–æ–∫")
print("    - sales_data: ", len(sales_data), " —Å—Ç—Ä–æ–∫")
print()
print("  –°–æ–∑–¥–∞–Ω–æ —Å–≤—è–∑–µ–π: ", relations_count)
print()
print("  –¢–∏–ø—ã —Å–≤—è–∑–µ–π:")
print("    - String ‚Üí String: ", relations_count, " —Å–≤—è–∑–µ–π")
print()

print("============================================================")
print("‚úÖ –¢–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã")
print("============================================================")

