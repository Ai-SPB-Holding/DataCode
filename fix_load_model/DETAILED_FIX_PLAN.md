# Детальный план исправления

## Проблема

Ошибка: `Syntax Error at line 4, column 0: Missing 'next i' in for loop`

## Анализ

1. **Архитектура правильная**: 
   - Используется `Result<Value, DataCodeError>` - правильно
   - Try/catch реализован через стек исключений - правильно

2. **Проблема в парсинге**: 
   - Когда цикл `for` находится внутри `try` блока, функция `execute_block_with_try_support` не находит соответствующий `next`

3. **Что происходит**:
   - Файл: `test_for_in_try_no_if.dc`
   - Содержимое `try` блока:
     ```
         for i in [1, 2, 3] do
             print("i = ", i)
         next i
     ```
   - `try_body` содержит эти 3 строки с отступами
   - Когда `execute_block_with_try_support` видит `for i in [1, 2, 3] do`, она должна найти `next i`
   - Но поиск не находит `next i` и цикл завершается с ошибкой

## Возможные причины

1. Цикл `while j < lines.len() && !var_stack.is_empty()` завершается преждевременно
2. Строка `next i` не распознается правильно
3. Логика проверки `next` работает неправильно

## Решение

Нужно использовать точно такую же логику, как в `handle_for_loop`, которая работает правильно.

## Следующие шаги

1. Сравнить логику `handle_for_loop` и `execute_block_with_try_support`
2. Убедиться, что обе используют одинаковый алгоритм поиска `next`
3. Добавить отладочный вывод для диагностики
4. Протестировать исправление

