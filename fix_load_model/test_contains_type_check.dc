# Тест проверки типов данных в contains
# Проверяем, что типы данных правильные

print("============================================================")
print("Тест: Проверка типов данных")
print("============================================================")

# Тест 1: Прямая проверка типа строки
print("Тест 1: Прямая строка")
local str1 = "quarter_2025_Q1"
print("  str1 = \"", str1, "\"")
print("  typeof(str1): ", typeof(str1))
print("  contains(str1, \"quarter_\"): ", contains(str1, "quarter_"))
print()

# Тест 2: Строка из массива (как возвращает list_files)
print("Тест 2: Строка из массива")
local test_array = ["quarter_2025_Q1", "03", "file.csv"]
print("  test_array = ", test_array)

for item in test_array do
    print("  item = ", item)
    print("    typeof(item): ", typeof(item))
    print("    contains(item, \"quarter_\"): ", contains(item, "quarter_"))
    print("    not contains(item, \"quarter_\"): ", not contains(item, "quarter_"))
    print()
next item

# Тест 3: Проверка с реальным list_files
print("Тест 3: Реальный list_files")
global base_path = getcwd() / "model_data"

try
    local files = list_files(base_path)
    print("  list_files вернул массив длиной: ", len(files))
    
    if len(files) > 0 do
        local first_item = files[0]
        print("  first_item = ", first_item)
        print("    typeof(first_item): ", typeof(first_item))
        
        # Проверяем contains
        if typeof(first_item) == "string" do
            print("    ✅ Тип правильный (string)")
            print("    contains(first_item, \"quarter_\"): ", contains(first_item, "quarter_"))
        else
            print("    ❌ Тип неправильный! Ожидается string, получен: ", typeof(first_item))
        endif
    endif
catch e
    print("  ⚠️  Ошибка: ", e)
endtry
print()

# Тест 4: Проверка условия if с разными типами
print("Тест 4: Условие if с проверкой типа")
local test_values = ["quarter_2025_Q1", "03", "file.csv", "quarter_2024_Q2"]

for test_val in test_values do
    print("  test_val = \"", test_val, "\"")
    print("    typeof(test_val): ", typeof(test_val))
    
    # Проверяем условие
    local condition_result = false
    if typeof(test_val) == "string" do
        local has_quarter = contains(test_val, "quarter_")
        local has_dot = contains(test_val, ".")
        condition_result = not has_quarter and not has_dot
        print("    has_quarter: ", has_quarter)
        print("    has_dot: ", has_dot)
        print("    condition_result (not has_quarter and not has_dot): ", condition_result)
    else
        print("    ⚠️  Тип не string, условие не проверяется")
    endif
    
    # Проверяем реальное условие if
    if not contains(test_val, "quarter_") and not contains(test_val, ".") do
        print("    ✅ Условие if: ВОШЕЛ")
    else
        print("    ⚠️  Условие if: НЕ ВОШЕЛ")
    endif
    print()
next test_val

print("============================================================")
print("✅ Тест завершен")
print("============================================================")

