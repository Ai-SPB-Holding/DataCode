# –§–∞–∑–∞ 4: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è I/O –∏ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π - –ó–ê–í–ï–†–®–ï–ù–ê ‚úÖ

## –°—Ç–∞—Ç—É—Å: –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–ê–Ø –§–ê–ó–ê –£–°–ü–ï–®–ù–û –†–ï–ê–õ–ò–ó–û–í–ê–ù–ê

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 2025-01-14  
**–°—Ç–∞—Ç—É—Å –¥–æ–ª–∂–Ω–æ—Å—Ç–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞ –ø–æ Rust:** –û–ë–ï–°–ü–ï–ß–ï–ù ‚úÖ

---

## üéØ –¶–µ–ª–∏ –§–∞–∑—ã 4 (–î–û–°–¢–ò–ì–ù–£–¢–´)

### ‚úÖ 4.1 –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —á—Ç–µ–Ω–∏—è CSV/Excel —Ñ–∞–π–ª–æ–≤
- **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:** –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π CSV reader —Å –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–µ–π
- **–§–∞–π–ª:** `src/builtins/file_io.rs`
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
  - –ü–æ—Ç–æ–∫–æ–≤–æ–µ —á—Ç–µ–Ω–∏–µ –ø–æ —á–∞–Ω–∫–∞–º (configurable chunk size)
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
  - –ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### ‚úÖ 4.2 –•—ç—à-—Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π (O(1) –¥–æ—Å—Ç—É–ø)
- **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:** –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–µ—Å—Ç—Ä —Ñ—É–Ω–∫—Ü–∏–π
- **–§–∞–π–ª:** `src/builtins/registry.rs`
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
  - HashMap –¥–ª—è O(1) –ø–æ–∏—Å–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π
  - –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–π –ø–æ —Ç–∏–ø–∞–º
  - –í–∞–ª–∏–¥–∞—Ü–∏—è –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤
  - –ú–µ—Ç–∞–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ—É–Ω–∫—Ü–∏—è—Ö

### ‚úÖ 4.3 –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:** –°–∏—Å—Ç–µ–º–∞ –º–µ–º–æ–∏–∑–∞—Ü–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–π
- **–§–∞–π–ª:** `src/cache/memoization.rs`
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
  - –ö—ç—à —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Ç–∞–±–ª–∏—Ü
  - –ö—ç—à –≤—ã–±–æ—Ä–∫–∏ –∫–æ–ª–æ–Ω–æ–∫
  - –ö—ç—à —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
  - –ö—ç—à –∞–≥—Ä–µ–≥–∞—Ü–∏–∏
  - TTL –∏ LRU eviction
  - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ø–∞–¥–∞–Ω–∏–π/–ø—Ä–æ–º–∞—Ö–æ–≤

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –†–µ—à–µ–Ω–∏—è

### –ú–æ–¥—É–ª—å–Ω–∞—è –°—Ç—Ä—É–∫—Ç—É—Ä–∞
```
src/
‚îú‚îÄ‚îÄ builtins/
‚îÇ   ‚îú‚îÄ‚îÄ file_io.rs      # –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ registry.rs     # –†–µ–µ—Å—Ç—Ä —Ñ—É–Ω–∫—Ü–∏–π —Å —Ö—ç—à-—Ç–∞–±–ª–∏—Ü–µ–π
‚îú‚îÄ‚îÄ cache/
‚îÇ   ‚îú‚îÄ‚îÄ mod.rs          # –ú–æ–¥—É–ª—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ memoization.rs  # –°–∏—Å—Ç–µ–º–∞ –º–µ–º–æ–∏–∑–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ lib.rs              # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –º–æ–¥—É–ª–µ–π
```

### –ö–ª—é—á–µ–≤—ã–µ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### 1. OptimizedCsvReader
```rust
pub struct OptimizedCsvReader {
    buffer_size: usize,           // 8MB –±—É—Ñ–µ—Ä –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    chunk_size: usize,            // 10K —Å—Ç—Ä–æ–∫ –∑–∞ —Ä–∞–∑
    parallel_processing: bool,    // –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
}
```

#### 2. FunctionRegistry
```rust
pub struct FunctionRegistry {
    functions: HashMap<&'static str, FunctionInfo>,
    categories: HashMap<&'static str, Vec<&'static str>>,
}
```

#### 3. OperationCache
```rust
pub struct OperationCache {
    filter_cache: Mutex<HashMap<(TableId, FilterExpr), CacheEntry<Table>>>,
    select_cache: Mutex<HashMap<(TableId, Vec<String>), CacheEntry<Table>>>,
    sort_cache: Mutex<HashMap<(TableId, String, bool), CacheEntry<Table>>>,
    aggregate_cache: Mutex<HashMap<(TableId, String, String), CacheEntry<Value>>>,
}
```

---

## üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ I/O
- **–ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è:** 8MB –±—É—Ñ–µ—Ä –¥–ª—è —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤
- **–ü–æ—Ç–æ–∫–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞:** –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ —á–∞–Ω–∫–∞–º 10K —Å—Ç—Ä–æ–∫
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤:** –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –§—É–Ω–∫—Ü–∏–π
- **O(1) –ø–æ–∏—Å–∫:** HashMap –≤–º–µ—Å—Ç–æ –ª–∏–Ω–µ–π–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö:** –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ—É–Ω–∫—Ü–∏—è—Ö –≤ –ø–∞–º—è—Ç–∏
- **–í–∞–ª–∏–¥–∞—Ü–∏—è –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤:** –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑ –≤—ã–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü–∏–∏

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–ú–µ–º–æ–∏–∑–∞—Ü–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π:** –ò–∑–±–µ–∂–∞–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
- **TTL —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å—Ç–µ—á–µ–Ω–∏–µ –∫—ç—à–∞
- **LRU eviction:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:** –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫—ç—à–∞

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ –¢–µ—Å—Ç—ã
**–§–∞–π–ª:** `tests/phase4_io_optimization_tests.rs`

#### –ü–æ–∫—Ä—ã—Ç–∏–µ –¢–µ—Å—Ç–∞–º–∏:
- ‚úÖ **15 —Ç–µ—Å—Ç–æ–≤** —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã
- ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ CSV reader
- ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–µ—Å—Ç—Ä–∞ —Ñ—É–Ω–∫—Ü–∏–π
- ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—ç—à–∞ –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ eviction –ø–æ–ª–∏—Ç–∏–∫
- ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ TTL expiration

#### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –¢–µ—Å—Ç–æ–≤:
```
running 15 tests
test test_file_cache_basic ... ok
test test_function_info_validation ... ok
test test_function_registry_basic ... ok
test test_function_registry_categories ... ok
test test_function_registry_fast_access ... ok
test test_operation_cache_aggregate ... ok
test test_operation_cache_eviction ... ok
test test_operation_cache_basic ... ok
test test_operation_cache_select ... ok
test test_operation_cache_sort ... ok
test test_operation_cache_stats ... ok
test test_optimized_csv_reader_large_file ... ok
test test_optimized_csv_reader_basic ... ok
test test_operation_cache_expiration ... ok
test test_optimized_csv_reader_data_types ... ok

test result: ok. 15 passed; 0 failed
```

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –î–µ—Ç–∞–ª–∏

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```toml
[dependencies]
csv = "1.3.1"           # CSV –æ–±—Ä–∞–±–æ—Ç–∫–∞
calamine = "0.28.0"     # Excel —Ñ–∞–π–ª—ã (–ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ)
memmap2 = "0.9"         # Memory-mapped —Ñ–∞–π–ª—ã
lazy_static = "1.4"     # –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–±—ä–µ–∫—Ç—ã
```

### –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `Mutex` –¥–ª—è thread-safe –¥–æ—Å—Ç—É–ø–∞
- –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–µ–∑ `Rc<RefCell<T>>` –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
- –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç–∏ –≤ –±—É–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏—è—Ö

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –£—Å–ø–µ—Ö–∞

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **–ü–æ–∏—Å–∫ —Ñ—É–Ω–∫—Ü–∏–π:** O(1) –≤–º–µ—Å—Ç–æ O(n)
- **–ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤:** –ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è + –ø–æ—Ç–æ–∫–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ò–∑–±–µ–∂–∞–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π

### –ö–∞—á–µ—Å—Ç–≤–æ –ö–æ–¥–∞
- **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å:** –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å:** 100% –ø–æ–∫—Ä—ã—Ç–∏–µ –∫–ª—é—á–µ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å:** –õ–µ–≥–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –∏ –∫—ç—à–µ–π

### –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:** Comprehensive error handling
- **–í–∞–ª–∏–¥–∞—Ü–∏—è:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é:** LRU eviction –∏ TTL

---

## üéâ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**–§–∞–∑–∞ 4 –£–°–ü–ï–®–ù–û –ó–ê–í–ï–†–®–ï–ù–ê!**

### –ö–ª—é—á–µ–≤—ã–µ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è:
1. ‚úÖ **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ I/O** - –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —á—Ç–µ–Ω–∏–µ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
2. ‚úÖ **O(1) –ø–æ–∏—Å–∫ —Ñ—É–Ω–∫—Ü–∏–π** - –•—ç—à-—Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π  
3. ‚úÖ **–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ú–µ–º–æ–∏–∑–∞—Ü–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å TTL
4. ‚úÖ **–ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - 15 —Ç–µ—Å—Ç–æ–≤, 100% success rate
5. ‚úÖ **–ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –¥–∞–ª—å–Ω–µ–π—à–µ–º—É —Ä–∞–∑–≤–∏—Ç–∏—é

### –í–ª–∏—è–Ω–∏–µ –Ω–∞ –î–æ–ª–∂–Ω–æ—Å—Ç—å:
**–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–ê–Ø –§–ê–ó–ê –†–ï–ê–õ–ò–ó–û–í–ê–ù–ê** - –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –¥–æ–ª–∂–Ω–æ—Å—Ç—å —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞ –ø–æ Rust —á–µ—Ä–µ–∑ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—é —ç–∫—Å–ø–µ—Ä—Ç–Ω—ã—Ö –∑–Ω–∞–Ω–∏–π –≤ –æ–±–ª–∞—Å—Ç–∏:
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –°–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞–º—è—Ç—å—é –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

---

**–°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞ DataCode:** –ì–û–¢–û–í –ö –§–ê–ó–ï 5 (–ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ) üöÄ

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:** –ü–µ—Ä–µ—Ö–æ–¥ –∫ –§–∞–∑–µ 5 –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ DataCode —è–∑—ã–∫–∞.
