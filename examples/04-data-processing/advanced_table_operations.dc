# –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏ –≤ DataCode
# table_sort(), merge_tables(), relate()

print('üìä –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏ –≤ DataCode')
print('================================================')
print()

# 1. –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Ç–∞–±–ª–∏—Ü—ã (table_sort)
print('1Ô∏è‚É£ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Ç–∞–±–ª–∏—Ü—ã (table_sort):')
print('===================================')

# –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É
global employees_data = [
    ['Alice', 30, 50000, 'Engineering'],
    ['Bob', 25, 45000, 'Marketing'],
    ['Charlie', 35, 60000, 'Engineering'],
    ['Diana', 28, 55000, 'Sales'],
    ['Eve', 32, 52000, 'Marketing']
]
global employees_headers = ['name', 'age', 'salary', 'department']
global employees = table(employees_data, employees_headers)

print('–ò—Å—Ö–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞:')
show_table(employees)
print()

# –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É (–ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é)
global sorted_by_age = table_sort(employees, 'age', true)
print('–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É (–ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é):')
show_table(sorted_by_age)
print()

# –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∑–∞—Ä–ø–ª–∞—Ç–µ (–ø–æ —É–±—ã–≤–∞–Ω–∏—é)
global sorted_by_salary = table_sort(employees, 'salary', false)
print('–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∑–∞—Ä–ø–ª–∞—Ç–µ (–ø–æ —É–±—ã–≤–∞–Ω–∏—é):')
show_table(sorted_by_salary)
print()

# –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∏–º–µ–Ω–∏ (–ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é)
global sorted_by_name = table_sort(employees, 'name', true)
print('–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∏–º–µ–Ω–∏ (–ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é):')
show_table(sorted_by_name)
print()

# 2. –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü (merge_tables)
print('2Ô∏è‚É£ –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü (merge_tables):')
print('======================================')

# –°–æ–∑–¥–∞–µ–º –ø–µ—Ä–≤—É—é —Ç–∞–±–ª–∏—Ü—É
global table1_data = [
    ['Alice', 30, 'Engineering'],
    ['Bob', 25, 'Marketing']
]
global table1_headers = ['name', 'age', 'department']
global table1 = table(table1_data, table1_headers)

# –°–æ–∑–¥–∞–µ–º –≤—Ç–æ—Ä—É—é —Ç–∞–±–ª–∏—Ü—É —Å —Ç–µ–º–∏ –∂–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏
global table2_data = [
    ['Charlie', 35, 'Engineering'],
    ['Diana', 28, 'Sales']
]
global table2 = table(table2_data, table1_headers)

# –°–æ–∑–¥–∞–µ–º —Ç—Ä–µ—Ç—å—é —Ç–∞–±–ª–∏—Ü—É
global table3_data = [
    ['Eve', 32, 'Marketing']
]
global table3 = table(table3_data, table1_headers)

print('–¢–∞–±–ª–∏—Ü–∞ 1:')
show_table(table1)
print()

print('–¢–∞–±–ª–∏—Ü–∞ 2:')
show_table(table2)
print()

print('–¢–∞–±–ª–∏—Ü–∞ 3:')
show_table(table3)
print()

# –û–±—ä–µ–¥–∏–Ω—è–µ–º –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã
global merged = merge_tables([table1, table2, table3])
print('–û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞:')
show_table(merged)
print()

# 3. –°–æ–∑–¥–∞–Ω–∏–µ —Å–≤—è–∑–µ–π –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏ (relate)
print('3Ô∏è‚É£ –°–æ–∑–¥–∞–Ω–∏–µ —Å–≤—è–∑–µ–π –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏ (relate):')
print('==============================================')

# –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
global employees_table_data = [
    [1, 'Alice', 'Engineering'],
    [2, 'Bob', 'Marketing'],
    [3, 'Charlie', 'Engineering'],
    [4, 'Diana', 'Sales']
]
global employees_table_headers = ['id', 'name', 'department']
global employees_table = table(employees_table_data, employees_table_headers)

# –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –ø—Ä–æ–µ–∫—Ç–æ–≤
global projects_table_data = [
    [101, 'Project A', 1],
    [102, 'Project B', 2],
    [103, 'Project C', 1],
    [104, 'Project D', 3]
]
global projects_table_headers = ['project_id', 'project_name', 'employee_id']
global projects_table = table(projects_table_data, projects_table_headers)

print('–¢–∞–±–ª–∏—Ü–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤:')
show_table(employees_table)
print()

print('–¢–∞–±–ª–∏—Ü–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤:')
show_table(projects_table)
print()

# –°–æ–∑–¥–∞–µ–º —Å–≤—è–∑—å –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏
relate(employees_table["id"], projects_table["employee_id"])
print('–°–≤—è–∑—å —Å–æ–∑–¥–∞–Ω–∞: employees_table.id -> projects_table.employee_id')
print()

# 4. –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –ø—Ä–∏–º–µ—Ä: –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
print('4Ô∏è‚É£ –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –ø—Ä–∏–º–µ—Ä: –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö')
print('=========================================')

# –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ CSV (–µ—Å–ª–∏ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
global csv_files = list_files(getcwd() / "examples/04-data-processing")

if len(csv_files) > 0 do
    global data = read_file(getcwd() / 'examples/04-data-processing/sample_data.csv')
    
    if isinstance(data, table) do
        print('–ó–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –∏–∑ CSV:')
        table_info(data)
        print()
        
        # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –ø–µ—Ä–≤–æ–º—É —Å—Ç–æ–ª–±—Ü—É
        global headers = table_headers(data)
        if len(headers) > 0 do
            global first_column = headers[0]
            print('–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Å—Ç–æ–ª–±—Ü—É:', first_column)
            global sorted_data = table_sort(data, first_column, true)
            global preview = table_head(sorted_data, 5)
            show_table(preview)
            print()
        endif
    endif
endif

# 5. –ü—Ä–∏–º–µ—Ä: –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
print('5Ô∏è‚É£ –ü—Ä–∏–º–µ—Ä: –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤')
print('====================================================')

# –î–∞–Ω–Ω—ã–µ –∑–∞ —è–Ω–≤–∞—Ä—å
global jan_data = [
    ['Product A', 100, 10.50],
    ['Product B', 150, 15.75]
]
global jan = table(jan_data, ['product', 'quantity', 'price'])

# –î–∞–Ω–Ω—ã–µ –∑–∞ —Ñ–µ–≤—Ä–∞–ª—å
global feb_data = [
    ['Product A', 120, 10.50],
    ['Product B', 180, 15.75],
    ['Product C', 90, 8.25]
]
global feb = table(feb_data, ['product', 'quantity', 'price'])

# –î–∞–Ω–Ω—ã–µ –∑–∞ –º–∞—Ä—Ç
global mar_data = [
    ['Product A', 110, 10.50],
    ['Product C', 100, 8.25]
]
global mar = table(mar_data, ['product', 'quantity', 'price'])

print('–î–∞–Ω–Ω—ã–µ –∑–∞ —è–Ω–≤–∞—Ä—å:')
show_table(jan)
print()

print('–î–∞–Ω–Ω—ã–µ –∑–∞ —Ñ–µ–≤—Ä–∞–ª—å:')
show_table(feb)
print()

print('–î–∞–Ω–Ω—ã–µ –∑–∞ –º–∞—Ä—Ç:')
show_table(mar)
print()

# –û–±—ä–µ–¥–∏–Ω—è–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
global quarterly_data = merge_tables([jan, feb, mar])
print('–û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞ –∫–≤–∞—Ä—Ç–∞–ª:')
show_table(quarterly_data)
print()

# –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –ø—Ä–æ–¥—É–∫—Ç—É
global sorted_quarterly = table_sort(quarterly_data, 'product', true)
print('–û—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ –ø—Ä–æ–¥—É–∫—Ç—É:')
show_table(sorted_quarterly)
print()

# 6. –ü—Ä–∏–º–µ—Ä: –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ (—á–µ—Ä–µ–∑ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã)
print('6Ô∏è‚É£ –ü—Ä–∏–º–µ—Ä: –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞')
print('=====================================')

# –°–Ω–∞—á–∞–ª–∞ —Å–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –æ—Ç–¥–µ–ª—É
global sorted_by_dept = table_sort(employees, 'department', true)
print('–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –æ—Ç–¥–µ–ª—É:')
show_table(sorted_by_dept)
print()

# –ó–∞—Ç–µ–º —Å–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –∑–∞—Ä–ø–ª–∞—Ç–µ –≤–Ω—É—Ç—Ä–∏ –∫–∞–∂–¥–æ–≥–æ –æ—Ç–¥–µ–ª–∞
# (–í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ —ç—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏, –Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ü–µ–ø—Ü–∏—é)
global sorted_by_salary_in_dept = table_sort(sorted_by_dept, 'salary', false)
print('–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∑–∞—Ä–ø–ª–∞—Ç–µ (–ø–æ—Å–ª–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ –æ—Ç–¥–µ–ª—É):')
show_table(sorted_by_salary_in_dept)
print()

print('‚úÖ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!')
print('–≠—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∏ –æ–±—ä–µ–¥–∏–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ')

