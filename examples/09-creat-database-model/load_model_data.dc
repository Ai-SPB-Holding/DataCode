# –°–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ model_data –∏ —Å–æ–∑–¥–∞–Ω–∏—è SQLite –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: datacode load_model_data.dc --build_model

print("============================================================")
print("–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ model_data")
print("============================================================")
print()

# –ë–∞–∑–æ–≤—ã–π –ø—É—Ç—å –∫ –¥–∞–Ω–Ω—ã–º
global base_path = getcwd()  / "model_data"
global docs_path = base_path / "docs"

print("üìÇ –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤...")
# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–∞–∫ null –Ω–∞ —Å–ª—É—á–∞–π –æ—à–∏–±–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏
global product_catalog = null
global regions = null
global employees = null

# –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏
try
    local product_catalog_temp = read_file(docs_path / "product_catalog.csv")
    product_catalog = product_catalog_temp
    print("  ‚úì –ó–∞–≥—Ä—É–∂–µ–Ω–æ –ø—Ä–æ–¥—É–∫—Ç–æ–≤: ", len(product_catalog))
catch e
    print("  ‚ö†Ô∏è  –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ product_catalog.csv: ", e)
endtry

try
    local regions_temp = read_file(docs_path / "regions.csv")
    regions = regions_temp
    print("  ‚úì –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ä–µ–≥–∏–æ–Ω–æ–≤: ", len(regions))
catch e
    print("  ‚ö†Ô∏è  –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ regions.csv: ", e)
endtry

try
    local employees_temp = read_file(docs_path / "employees.csv")
    employees = employees_temp
    print("  ‚úì –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤: ", len(employees))
catch e
    print("  ‚ö†Ô∏è  –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ employees.csv: ", e)
endtry
print()

# –ò—Å–ø–æ–ª—å–∑—É–µ–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é merge_tables –∏–∑ DataCode
# –§—É–Ω–∫—Ü–∏—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü —Ç–µ–ø–µ—Ä—å –≤—Å—Ç—Ä–æ–µ–Ω–∞ –≤ —è–∑—ã–∫

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–µ—Å—è—Ü–∞ (–¥–æ–±–∞–≤–ª—è–µ—Ç –≤–µ–¥—É—â–∏–π –Ω–æ–ª—å)
global function format_month(month) do
    if month < 10 do
        return "0" + month
    else
        return "" + month
    endif
endfunction

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ª–∏—á–∏—è —Ñ–∞–π–ª–∞ –≤ —Å–ø–∏—Å–∫–µ
global function file_exists(files, filename) do
    for file in files do
        if file == filename do
            return true
        endif
    next file
    return false
endfunction

print("üìä –ó–∞–≥—Ä—É–∑–∫–∞ –µ–∂–µ–º–µ—Å—è—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö...")
# –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –≥–æ–¥–æ–≤ –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ model_data (—Ç–µ–ø–µ—Ä—å list_files() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏)
global year_dirs = []
try
    year_dirs = list_files(base_path)
    print("  –ù–∞–π–¥–µ–Ω–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ model_data: ", len(year_dirs))
catch e
    print("  ‚ö†Ô∏è  –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤ –∏–∑ model_data: ", e)
    print("  ‚ö†Ô∏è  –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å –ø—É—Å—Ç—ã–º —Å–ø–∏—Å–∫–æ–º...")
endtry

# –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –µ–∂–µ–º–µ—Å—è—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
global all_sales_tables = []
global all_inventory_tables = []
global all_refunds_tables = []
global all_marketing_tables = []

# –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∂–¥—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≥–æ–¥–∞
for year_dir in year_dirs do
    # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ñ–∞–π–ª—ã –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
    if year_dir != "docs" and year_dir != "__pycache__" and year_dir != "generate_model_data.py" and not contains(year_dir, ".") do
        # –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –º–µ—Å—è—Ü–µ–≤ –≤ –≥–æ–¥—É        
        print("  üîç –ì–æ–¥ ", year_dir)
        # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∂–¥—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –º–µ—Å—è—Ü–∞
        for month_dir_name in list_files(base_path / year_dir) do
            if contains(month_dir_name, ".") do
                next month_dir_name
            endif
            # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∏ —Ñ–∞–π–ª—ã
            print("     üîç –ú–µ—Å—è—Ü ", month_dir_name)
            if not contains(month_dir_name, "quarter_") and not contains(month_dir_name, ".") do
                # month_dir_name –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å "01", "02", ..., "12"
                for file in list_files(base_path / year_dir / month_dir_name) do
                    # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∏ —Ñ–∞–π–ª—ã —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º–∏ (–∫—Ä–æ–º–µ CSV)
                    if contains(file, "quarter_") or (contains(file, ".") and not contains(file, ".csv")) do
                        print("         ‚ö†Ô∏è  –ü—Ä–æ–ø—É—â–µ–Ω (–∫–≤–∞—Ä—Ç–∞–ª—å–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –∏–ª–∏ –Ω–µ CSV —Ñ–∞–π–ª): ", file)
                    else
                        print("         üîç —Ñ–∞–π–ª ", file)
                        try
                            local data = read_file(base_path / year_dir / month_dir_name / file)
                            if contains(file, "sales") do
                                try
                                    all_sales_tables = push(all_sales_tables, data)
                                catch e
                                    print("  ‚ö†Ô∏è  –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ", file, ": ", e)
                                endtry
                            else if contains(file, "inventory") do
                                try
                                    all_inventory_tables = push(all_inventory_tables, data)
                                catch e
                                    print("  ‚ö†Ô∏è  –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ", file, ": ", e)
                                endtry
                            else if contains(file, "marketing_spend") do
                                try
                                    all_marketing_tables = push(all_marketing_tables, data)
                                catch e
                                    print("  ‚ö†Ô∏è  –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ", file, ": ", e)
                                endtry
                            else if contains(file, "refunds") do
                                try
                                    all_refunds_tables = push(all_refunds_tables, data)
                                catch e
                                    print("  ‚ö†Ô∏è  –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ", file, ": ", e)
                                endtry
                            endif
                        catch e
                            print("  ‚ö†Ô∏è  –û—à–∏–±–∫–∞ file ", file, ": ", e)
                        endtry
                    endif
                next file
            endif
        next month_dir_name
    endif
next year_dir

print("  ‚úì –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ñ–∞–π–ª–æ–≤ sales: ", len(all_sales_tables))
print("  ‚úì –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ñ–∞–π–ª–æ–≤ inventory: ", len(all_inventory_tables))
print("  ‚úì –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ñ–∞–π–ª–æ–≤ refunds: ", len(all_refunds_tables))
print("  ‚úì –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ñ–∞–π–ª–æ–≤ marketing: ", len(all_marketing_tables))
print()

# –û–±—ä–µ–¥–∏–Ω—è–µ–º –≤—Å–µ –µ–∂–µ–º–µ—Å—è—á–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
print("üîó –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –µ–∂–µ–º–µ—Å—è—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö...")
print("  –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ sales (", len(all_sales_tables), " —Ç–∞–±–ª–∏—Ü)...")
global sales_all = merge_tables(all_sales_tables)
print("  –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ inventory (", len(all_inventory_tables), " —Ç–∞–±–ª–∏—Ü)...")
global inventory_all = merge_tables(all_inventory_tables)
print("  –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ refunds (", len(all_refunds_tables), " —Ç–∞–±–ª–∏—Ü)...")
global refunds_all = merge_tables(all_refunds_tables)
print("  –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ marketing (", len(all_marketing_tables), " —Ç–∞–±–ª–∏—Ü)...")
global marketing_spend_all = merge_tables(all_marketing_tables)

if sales_all != null do
    print("  ‚úì –û–±—ä–µ–¥–∏–Ω–µ–Ω–æ –ø—Ä–æ–¥–∞–∂: ", len(sales_all))
endif
if inventory_all != null do
    print("  ‚úì –û–±—ä–µ–¥–∏–Ω–µ–Ω–æ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è: ", len(inventory_all))
endif
if refunds_all != null do
    print("  ‚úì –û–±—ä–µ–¥–∏–Ω–µ–Ω–æ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤: ", len(refunds_all))
endif
if marketing_spend_all != null do
    print("  ‚úì –û–±—ä–µ–¥–∏–Ω–µ–Ω–æ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∞: ", len(marketing_spend_all))
endif
print()

# –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
print("üìà –ó–∞–≥—Ä—É–∑–∫–∞ –∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã—Ö –∞–≥—Ä–µ–≥–∞—Ç–æ–≤...")
global all_financial_summary_tables = []
global all_regional_summary_tables = []
global all_product_summary_tables = []
global all_employee_performance_tables = []

# –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∂–¥—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≥–æ–¥–∞ –¥–ª—è –∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
for year_dir in year_dirs do
    # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ñ–∞–π–ª—ã –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
    if year_dir != "docs" and year_dir != "__pycache__" and year_dir != "generate_model_data.py" and not contains(year_dir, ".") do

        print("  üîç –ì–æ–¥ ", year_dir)
        
        # –ò—â–µ–º –∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –≤–Ω—É—Ç—Ä–∏ –º–µ—Å—è—á–Ω—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
        for month_dir_name in list_files(base_path / year_dir) do
            if contains(month_dir_name, ".") do
                next month_dir_name
            endif

            # –ò—â–µ–º –∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –≤–Ω—É—Ç—Ä–∏ –º–µ—Å—è—á–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
            for item in list_files(base_path / year_dir / month_dir_name) do
                if contains(item, "quarter_") do
                    print("     üîç –ú–µ—Å—è—Ü ", month_dir_name)
                    # –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –≤ –∫–≤–∞—Ä—Ç–∞–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
                    local quarter_files = null
                    try
                        quarter_files = list_files(base_path / year_dir / month_dir_name / item)
                    catch e
                        # –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤ –≤ –∫–≤–∞—Ä—Ç–∞–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
                        print("  ‚ö†Ô∏è  –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–≤–∞—Ä—Ç–∞–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ ", item, ": ", e)
                        quarter_files = null
                    endtry
                    
                    if quarter_files != null do
                        # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∂–¥—ã–π —Ñ–∞–π–ª –≤ –∫–≤–∞—Ä—Ç–∞–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
                        for quarter_file in quarter_files do
                            print("         üîç —Ñ–∞–π–ª ", quarter_file)
                            local data = read_file(base_path / year_dir / month_dir_name / item / quarter_file)

                            # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø —Ñ–∞–π–ª–∞ –ø–æ –∏–º–µ–Ω–∏ –∏ –∑–∞–≥—Ä—É–∂–∞–µ–º
                            if contains(quarter_file, "financial_summary_") do
                                try
                                    all_financial_summary_tables = push(all_financial_summary_tables, data)
                                catch e
                                    print("  ‚ö†Ô∏è  –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ", quarter_file, ": ", e)
                                endtry
                            endif
                            
                            if contains(quarter_file, "regional_summary_") do
                                try
                                    all_regional_summary_tables = push(all_regional_summary_tables, data)
                                catch e
                                    print("  ‚ö†Ô∏è  –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ", quarter_file, ": ", e)
                                endtry
                            endif
                            
                            if contains(quarter_file, "product_summary_") do
                                try
                                    all_product_summary_tables = push(all_product_summary_tables, data)
                                catch e
                                    print("  ‚ö†Ô∏è  –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ", quarter_file, ": ", e)
                                endtry
                            endif
                            
                            if contains(quarter_file, "employee_performance_") do
                                try
                                    all_employee_performance_tables = push(all_employee_performance_tables, data)
                                catch e
                                    print("  ‚ö†Ô∏è  –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ", quarter_file, ": ", e)
                                endtry
                            endif
                        next quarter_file
                    endif
                endif
            next item
        next month_dir_name
    endif
next year_dir

print("  ‚úì –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ñ–∞–π–ª–æ–≤ financial_summary: ", len(all_financial_summary_tables))
print("  ‚úì –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ñ–∞–π–ª–æ–≤ regional_summary: ", len(all_regional_summary_tables))
print("  ‚úì –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ñ–∞–π–ª–æ–≤ product_summary: ", len(all_product_summary_tables))
print("  ‚úì –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ñ–∞–π–ª–æ–≤ employee_performance: ", len(all_employee_performance_tables))
print()

# –û–±—ä–µ–¥–∏–Ω—è–µ–º –∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
print("üîó –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö...")
global financial_summary_all = merge_tables(all_financial_summary_tables)
global regional_summary_all = merge_tables(all_regional_summary_tables)
global product_summary_all = merge_tables(all_product_summary_tables)
global employee_performance_all = merge_tables(all_employee_performance_tables)

if financial_summary_all != null do
    print("  ‚úì –û–±—ä–µ–¥–∏–Ω–µ–Ω–æ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Å–≤–æ–¥–æ–≤: ", len(financial_summary_all))
endif
if regional_summary_all != null do
    print("  ‚úì –û–±—ä–µ–¥–∏–Ω–µ–Ω–æ —Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —Å–≤–æ–¥–æ–≤: ", len(regional_summary_all))
endif
if product_summary_all != null do
    print("  ‚úì –û–±—ä–µ–¥–∏–Ω–µ–Ω–æ –ø—Ä–æ–¥—É–∫—Ç–æ–≤—ã—Ö —Å–≤–æ–¥–æ–≤: ", len(product_summary_all))
endif
if employee_performance_all != null do
    print("  ‚úì –û–±—ä–µ–¥–∏–Ω–µ–Ω–æ –æ—Ç—á–µ—Ç–æ–≤ –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º: ", len(employee_performance_all))
endif
print()

# –°–æ–∑–¥–∞–Ω–∏–µ —Å–≤—è–∑–µ–π –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏
print("üîó –°–æ–∑–¥–∞–Ω–∏–µ —Å–≤—è–∑–µ–π –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏...")
global relations_created = 0

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è —Å–≤—è–∑–∏
global function create_relation(table1, col1, table2, col2, relation_name) do
    try
        local headers1 = table_headers(table1)

        if contains(headers1, col1) and contains(headers2, col2) do
            relate(table1[col1], table2[col2])
            print("  ‚úì ", relation_name)
            return true
        else
            print("  ‚ö†Ô∏è  ", relation_name, " - –∫–æ–ª–æ–Ω–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")
            return false
        endif
    catch e
        print("  ‚úó ", relation_name, " - –æ—à–∏–±–∫–∞: ", e)
        return false
    endtry
endfunction

# –°–≤—è–∑–∏ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤ —Å –µ–∂–µ–º–µ—Å—è—á–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
if not (sales_all == null) do
    if not (product_catalog == null) do
        if create_relation(product_catalog, "product_id", sales_all, "product_id", "product_catalog.product_id ‚Üî sales_all.product_id") do
            relations_created = relations_created + 1
        endif
    endif
    
    if not (regions == null) do
        if create_relation(regions, "region_code", sales_all, "region", "regions.region_code ‚Üî sales_all.region") do
            relations_created = relations_created + 1
        endif
    endif
    
    if not (employees == null) do
        if create_relation(employees, "employee_id", sales_all, "employee_id", "employees.employee_id ‚Üî sales_all.employee_id") do
            relations_created = relations_created + 1
        endif
    endif
endif

if not (inventory_all == null) do
    if not (product_catalog == null) do
        if create_relation(product_catalog, "product_id", inventory_all, "product_id", "product_catalog.product_id ‚Üî inventory_all.product_id") do
            relations_created = relations_created + 1
        endif
    endif
    
    if not (regions == null) do
        if create_relation(regions, "region_code", inventory_all, "region", "regions.region_code ‚Üî inventory_all.region") do
            relations_created = relations_created + 1
        endif
    endif
endif

if not (refunds_all == null) do
    if not (sales_all == null) do
        if create_relation(sales_all, "transaction_id", refunds_all, "transaction_id", "sales_all.transaction_id ‚Üî refunds_all.transaction_id") do
            relations_created = relations_created + 1
        endif
    endif
    
    if not (product_catalog == null) do
        if create_relation(product_catalog, "product_id", refunds_all, "product_id", "product_catalog.product_id ‚Üî refunds_all.product_id") do
            relations_created = relations_created + 1
        endif
    endif
    
    if not (regions == null) do
        if create_relation(regions, "region_code", refunds_all, "region", "regions.region_code ‚Üî refunds_all.region") do
            relations_created = relations_created + 1
        endif
    endif
endif

if not (marketing_spend_all == null) do
    if not (regions == null) do
        if create_relation(regions, "region_code", marketing_spend_all, "region", "regions.region_code ‚Üî marketing_spend_all.region") do
            relations_created = relations_created + 1
        endif
    endif
endif

# –°–≤—è–∑–∏ —Å –∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã–º–∏ –∞–≥—Ä–µ–≥–∞—Ç–∞–º–∏
if not (product_summary_all == null) do
    if not (product_catalog == null) do
        if create_relation(product_catalog, "product_id", product_summary_all, "product_id", "product_catalog.product_id ‚Üî product_summary_all.product_id") do
            relations_created = relations_created + 1
        endif
    endif
endif

if not (regional_summary_all == null) do
    if not (regions == null) do
        if create_relation(regions, "region_code", regional_summary_all, "region", "regions.region_code ‚Üî regional_summary_all.region") do
            relations_created = relations_created + 1
        endif
    endif
endif

if not (employee_performance_all == null) do
    if not (employees == null) do
        if create_relation(employees, "employee_id", employee_performance_all, "employee_id", "employees.employee_id ‚Üî employee_performance_all.employee_id") do
            relations_created = relations_created + 1
        endif
    endif
endif

print("  ‚úì –°–æ–∑–¥–∞–Ω–æ —Å–≤—è–∑–µ–π: ", relations_created)
print()

# –ü—Ä–æ–≤–µ—Ä–∫–∞: –≤—ã–∑–æ–≤ relate() –Ω–∞–ø—Ä—è–º—É—é –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
if not (product_catalog == null) and not (sales_all == null) do
    print("üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞: –ü—Ä—è–º–æ–π –≤—ã–∑–æ–≤ relate()...")
    try
        relate(product_catalog["product_id"], sales_all["product_id"])
        print("  ‚úì relate() –≤—ã–∑–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ")
    catch e
        print("  ‚úó –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ relate(): ", e)
    endtry
endif
print()

print("============================================================")
print("‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞–≤–µ—Ä—à–µ–Ω–∞!")
print("============================================================")
print()
print("üìä –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:")
print("  ‚Ä¢ –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏:")
if product_catalog != null do
    print("    - product_catalog: ", len(product_catalog), " —Å—Ç—Ä–æ–∫")
endif
if regions != null do
    print("    - regions: ", len(regions), " —Å—Ç—Ä–æ–∫")
endif
if employees != null do
    print("    - employees: ", len(employees), " —Å—Ç—Ä–æ–∫")
endif
print("  ‚Ä¢ –ï–∂–µ–º–µ—Å—è—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:")
if sales_all != null do
    print("    - sales_all: ", len(sales_all), " —Å—Ç—Ä–æ–∫")
endif
if inventory_all != null do
    print("    - inventory_all: ", len(inventory_all), " —Å—Ç—Ä–æ–∫")
endif
if refunds_all != null do
    print("    - refunds_all: ", len(refunds_all), " —Å—Ç—Ä–æ–∫")
endif
if marketing_spend_all != null do
    print("    - marketing_spend_all: ", len(marketing_spend_all), " —Å—Ç—Ä–æ–∫")
endif
print("  ‚Ä¢ –ö–≤–∞—Ä—Ç–∞–ª—å–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ç—ã:")
if financial_summary_all != null do
    print("    - financial_summary_all: ", len(financial_summary_all), " —Å—Ç—Ä–æ–∫")
endif
if regional_summary_all != null do
    print("    - regional_summary_all: ", len(regional_summary_all), " —Å—Ç—Ä–æ–∫")
endif
if product_summary_all != null do
    print("    - product_summary_all: ", len(product_summary_all), " —Å—Ç—Ä–æ–∫")
endif
if employee_performance_all != null do
    print("    - employee_performance_all: ", len(employee_performance_all), " —Å—Ç—Ä–æ–∫")
endif
print("  ‚Ä¢ –°–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏:")
print("    - –°–æ–∑–¥–∞–Ω–æ —Å–≤—è–∑–µ–π: ", relations_created)
print()
print("üí° –î–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ SQLite –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ: datacode load_model_data.dc --build_model")
print()