# –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –≤ DataCode
# path(), list_files(), read_file(), analyze_csv(), write_file()

print('üìÅ –§–∞–π–ª–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ DataCode')
print('=================================')
print()

# 1. –†–∞–±–æ—Ç–∞ —Å –ø—É—Ç—è–º–∏ (path)
print('1Ô∏è‚É£ –†–∞–±–æ—Ç–∞ —Å –ø—É—Ç—è–º–∏ (path):')
print('==========================')

global current_dir = getcwd()
print('–¢–µ–∫—É—â–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è:', current_dir)

global file_path = path('test.txt')
global relative_path = path('data/sample.csv')
global absolute_path = path('/tmp/test.txt')

print('file_path =', file_path)
print('relative_path =', relative_path)
print('absolute_path =', absolute_path)
print('isinstance(file_path, path):', isinstance(file_path, path))
print()

# 2. –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ (list_files)
print('2Ô∏è‚É£ –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ (list_files):')
print('==============================')

# –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –≤ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
global files = list_files(current_dir)
print('–§–∞–π–ª—ã –≤ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:')
print('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤:', len(files))
if len(files) > 0 do
    print('–ü–µ—Ä–≤—ã–µ 5 —Ñ–∞–π–ª–æ–≤:')
    for i in range(0, min(5, len(files))) do
        print('  -', files[i])
    next i
endif
print()

# –ü–æ–∏—Å–∫ CSV —Ñ–∞–π–ª–æ–≤ –≤ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
global all_files_current = list_files(current_dir)
global csv_files = []
for file in all_files_current do
    local file_str = str(file)
    if contains(file_str, '.csv') do
        push(csv_files, file)
    endif
next file

print('CSV —Ñ–∞–π–ª—ã –≤ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:')
print('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ CSV —Ñ–∞–π–ª–æ–≤:', len(csv_files))
if len(csv_files) > 0 do
    for file in csv_files do
        print('  -', file)
    next file
endif
print()

# 3. –ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ (read_file)
print('3Ô∏è‚É£ –ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ (read_file):')
print('=============================')

# –ß—Ç–µ–Ω–∏–µ CSV —Ñ–∞–π–ª–∞ (—Å–æ–∑–¥–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É)
global csv_path = path('examples/04-data-processing/sample_data.csv')
global csv_data = read_file(csv_path)
print('CSV —Ñ–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω –∫–∞–∫ —Ç–∞–±–ª–∏—Ü–∞:')
if isinstance(csv_data, table) do
    table_info(csv_data)
    print('–ü–µ—Ä–≤—ã–µ 3 —Å—Ç—Ä–æ–∫–∏:')
    global preview = table_head(csv_data, 3)
    show_table(preview)
endif
print()

# 4. –ê–Ω–∞–ª–∏–∑ CSV —Ñ–∞–π–ª–∞ (analyze_csv)
print('4Ô∏è‚É£ –ê–Ω–∞–ª–∏–∑ CSV —Ñ–∞–π–ª–∞ (analyze_csv):')
print('===================================')

global analysis = analyze_csv(csv_path)
print('–ê–Ω–∞–ª–∏–∑ CSV —Ñ–∞–π–ª–∞:')
print('–†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞:', analysis)
print()

# 5. –ó–∞–ø–∏—Å—å —Ñ–∞–π–ª–∞ (write_file)
print('5Ô∏è‚É£ –ó–∞–ø–∏—Å—å —Ñ–∞–π–ª–∞ (write_file):')
print('==============================')

# –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª
global test_content = 'Hello, DataCode!\nThis is a test file.\nCreated at: ' + now()
global test_file = path('test_output.txt')

write_file(test_file, test_content)
print('–§–∞–π–ª –∑–∞–ø–∏—Å–∞–Ω:', test_file)

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ñ–∞–π–ª —Å–æ–∑–¥–∞–Ω (—á–∏—Ç–∞–µ–º –æ–±—Ä–∞—Ç–Ω–æ)
global read_back = read_file(test_file)
print('–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∑–∞–ø–∏—Å–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞:')
print(read_back)
print()

# 6. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä: –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤
print('6Ô∏è‚É£ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä: –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤')
print('====================================================')

global function process_csv_files(directory) do
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å –¥–ª—è –ø–æ–∏—Å–∫–∞ CSV —Ñ–∞–π–ª–æ–≤
    local dir_path = path(directory)
    local all_files = list_files(dir_path)
    local csv_files = []
    
    # –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ CSV —Ñ–∞–π–ª—ã
    for file in all_files do
        local file_str = str(file)
        if contains(file_str, '.csv') do
            push(csv_files, file)
        endif
    next file
    
    local results = []
    
    for file in csv_files do
        local data = read_file(file)
        if isinstance(data, table) do
            local info = 'File: ' + str(file) + ', Rows: ' + str(len(data))
            push(results, info)
        endif
    next file
    
    return results
endfunction

print('–û–±—Ä–∞–±–æ—Ç–∫–∞ CSV —Ñ–∞–π–ª–æ–≤ –≤ examples/04-data-processing/:')
global processed = process_csv_files('examples/04-data-processing/')
for result in processed do
    print('  ', result)
next result
print()

# 7. –ü—Ä–∏–º–µ—Ä: —Å–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞
print('7Ô∏è‚É£ –ü—Ä–∏–º–µ—Ä: —Å–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞')
print('==========================')

global function create_report(filename, data) do
    local report = 'DataCode Report\n'
    report = report + '================\n'
    report = report + 'Generated at: ' + now() + '\n'
    report = report + '\n'
    
    if isinstance(data, table) do
        report = report + 'Table Information:\n'
        report = report + 'Rows: ' + str(len(data)) + '\n'
        local headers = table_headers(data)
        report = report + 'Columns: ' + str(len(headers)) + '\n'
        report = report + 'Column names: ' + str(headers) + '\n'
    else
        report = report + 'Data: ' + str(data) + '\n'
    endif
    
    report = report + '\n'
    report = report + 'End of Report\n'
    
    write_file(path(filename), report)
    return 'Report created: ' + filename
endfunction

global report_result = create_report('report.txt', csv_data)
print(report_result)
print()

print('‚úÖ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –∑–∞–≤–µ—Ä—à–µ–Ω–∞!')
print('DataCode –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–æ—â–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏')

