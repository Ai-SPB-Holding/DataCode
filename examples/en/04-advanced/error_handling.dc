# Error Handling in DataCode
# Demonstrates try/catch/throw/finally blocks

print("============================================================")
print("Error Handling Examples")
print("============================================================")
print()

# Example 1: Basic try/catch
print("ğŸ” Example 1: Basic try/catch...")
try {
    global result = 10 / 0
    print("  This won't be printed")
} catch e {
    print("  âœ“ Caught error:", e)
    global error_handled = true
}
print()

# Example 2: try/catch without error variable
print("ğŸ” Example 2: try/catch without error variable...")
try {
    global x = 42
    print("  âœ“ Code executed successfully: x =", x)
} catch {
    print("  This won't be printed (no error)")
}
print()

# Example 3: try/finally
print("ğŸ” Example 3: try/finally...")
global cleanup_done = false
try {
    global value = 100
    print("  âœ“ Value set to", value)
} finally {
    global cleanup_done = true
    print("  âœ“ Finally block executed (cleanup done =", cleanup_done, ")")
}
print()

# Example 4: try/catch/finally
print("ğŸ” Example 4: try/catch/finally...")
global error_caught = false
global cleanup_completed = false
try {
    throw "Test exception"
    print("  This won't be printed")
} catch e {
    global error_caught = true
    print("  âœ“ Caught exception:", e)
} finally {
    global cleanup_completed = true
    print("  âœ“ Finally block always executes (cleanup =", cleanup_completed, ")")
}
print()

# Example 5: Using throw to create exceptions
print("ğŸ” Example 5: Using throw to create exceptions...")
fn validate_age(age) {
    if age < 0 {
        throw "Age cannot be negative"
    }
    if age > 150 {
        throw "Age seems unrealistic"
    }
    return true
}

try {
    validate_age(-5)
} catch e {
    print("  âœ“ Validation error caught:", e)
}

try {
    validate_age(200)
} catch e {
    print("  âœ“ Validation error caught:", e)
}

try {
    validate_age(25)
    print("  âœ“ Age validation passed for 25")
} catch e {
    print("  This won't be printed")
}
print()

# Example 6: Nested try/catch blocks
print("ğŸ” Example 6: Nested try/catch blocks...")
try {
    global outer_step = "step1"
    print("  âœ“ Outer try: step1")
    
    try {
        global inner_step = "step2"
        print("  âœ“ Inner try: step2")
        throw "Inner exception"
    } catch e {
        print("  âœ“ Inner catch: handled", e)
        global inner_handled = true
    }
    
    global outer_step = "step3"
    print("  âœ“ Outer try: step3")
} catch e {
    print("  âœ“ Outer catch: handled", e)
}
print()

# Example 7: Error handling in functions
print("ğŸ” Example 7: Error handling in functions...")
fn safe_divide(a, b) {
    if b == 0 {
        throw "Division by zero is not allowed"
    }
    return a / b
}

fn calculate_with_error_handling(a, b) {
    try {
        let result = safe_divide(a, b)
        return result
    } catch e {
        print("  âš ï¸  Error in calculation:", e)
        return null
    }
}

global result1 = calculate_with_error_handling(10, 2)
print("  âœ“ 10 / 2 =", result1)

global result2 = calculate_with_error_handling(10, 0)
print("  âœ“ 10 / 0 handled safely, result =", result2)
print()

# Example 8: File operations with error handling
print("ğŸ” Example 8: File operations with error handling...")
fn safe_read_file(file_path) {
    try {
        let data = read_file(file_path)
        return data
    } catch e {
        print("  âš ï¸  Failed to read file:", file_path, "-", e)
        return null
    }
}

global test_file = path("nonexistent_file.txt")
global file_data = safe_read_file(test_file)
if file_data == null {
    print("  âœ“ File read error handled gracefully")
}
print()

# Example 9: Multiple operations with error handling
print("ğŸ” Example 9: Multiple operations with error handling...")
fn process_data(data) {
    try {
        if data == null {
            throw "Data is null"
        }
        if len(data) == 0 {
            throw "Data is empty"
        }
        return "Processing successful"
    } catch e {
        return "Error: " + e
    }
}

global result3 = process_data([1, 2, 3])
print("  âœ“", result3)

global result4 = process_data(null)
print("  âœ“", result4)

global result5 = process_data([])
print("  âœ“", result5)
print()

# Example 10: Error propagation
print("ğŸ” Example 10: Error propagation...")
fn level1() {
    throw "Error from level 1"
}

fn level2() {
    level1()
}

try {
    level2()
} catch e {
    print("  âœ“ Error propagated and caught:", e)
}
print()

print("============================================================")
print("âœ… Error Handling Examples Completed")
print("============================================================")

